stepwise,
labelsize = 0.5,
#log = "x",
xlab = "x",
standardize = T
)
set.seed(42)
final <- penalized(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
trace = F,
lambda1 = opt$lambda
)
round(coef(hepato_final, standardize = T), 3)
round(coef(final, standardize = T), 3)
round(coef(final, standardize = F), 3)
round(coef(final, standardize = T), 3)
final <- penalized(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
trace = F,
lambda1 = opt$lambda
)
final <- penalized(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
lambda1 = opt$lambda
)
round(coef(final, standardize = T), 3)
final <- penalized(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
lambda1 = opt$lambda,
trace = F
)
final <- penalized(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
lambda1 = opt$lambda,
trace = F
)
#round(coef(final, standardize = T), 3)
final
#round(coef(final, standardize = T), 3)
summary(final)
#round(coef(final, standardize = T), 3)
final
#round(coef(final, standardize = T), 3)
str(final)
#round(coef(final, standardize = T), 3)
#str(final)
final@penalized
#round(coef(final, standardize = T), 3)
#str(final)
names(final@penalized)
#round(coef(final, standardize = T), 3)
#str(final)
names(final@penalized)[final@penalized != 0]
#round(coef(final, standardize = T), 3)
#str(final)
names(final@penalized)[final@penalized != 0]
final <- penalized(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
lambda1 = opt$lambda,
trace = F
)
#round(coef(final, standardize = T), 3)
#str(final)
#names(final@penalized)[final@penalized != 0]
final@penalized
formula = paste("Surv(data$age, data$dead) ~ ", paste(nonzero_varnames, sep = "+"))
nonzero_varnames <- names(final@penalized)[final@penalized != 0]
formula = paste("Surv(data$age, data$dead) ~ ", paste(nonzero_varnames, sep = "+"))
formula
formula = paste("Surv(data$age, data$dead) ~ ", paste0(nonzero_varnames, sep = "+"))
formula
nonzero_varnames
paste0(nonzero_varnames, sep = "+")
paste(nonzero_varnames, sep = "+")
paste(nonzero_varnames, sep = "+", collapse = "")
paste(nonzero_varnames, sep = "+", collapse = " + ")
paste(nonzero_varnames, collapse = " + ")
formula = paste("Surv(data$age, data$dead) ~ ", paste0(nonzero_varnames, collapse = "+ "))
formula
formula = paste("Surv(data$age, data$dead) ~", paste0(nonzero_varnames, collapse = "+ "))
cox <- coxph(
as.formula(formula)
)
cox <- coxph(
Surv(data$age, data$dead) ~ adv_density+adv_mom+adv_rain:adv_mom
)
cox <- coxph(
Surv(data$age, data$dead) ~ adv_density+adv_mom+adv_rain:adv_mom,
data = data
)
cox <- coxph(
Surv(data$age, data$dead) ~ adv_density+adv_mom+adv_rain:adv_mom,
data = data_matrix
)
cox <- coxph(
#Surv(data$age, data$dead) ~ adv_density+adv_mom+adv_rain:adv_mom,
as.formula(formula),
data = data_matrix
)
cox <- coxph(
#Surv(data$age, data$dead) ~ adv_density+adv_mom+adv_rain:adv_mom,
as.formula(formula),
data = data.frame(data_matrix)
)
summary(cox)
cox <- coxph(
as.formula(formula),
data = data.frame(penalized_covariates)
)
summary(cox)
data_composite <- raw_data %>%
mutate(composite = sum(adv_rain, adv_sib, adv_mom_dsi)) %>%
select(adv_density, adv_mom, composite)
View(data_composite)
cox_composite <- coxph(
Surv(data$age, data$dead) ~ adv_density + adv_mom + adv_mom:composite,
data = data_composite
)
summary(cox_composite)
View(data_composite)
data_composite <- raw_data %>%
mutate(composite = adv_rain+adv_sib+adv_mom_dsi) %>%
select(adv_density, adv_mom, composite)
cox_composite <- coxph(
Surv(data$age, data$dead) ~ adv_density + adv_mom + adv_mom:composite,
data = data_composite
)
summary(cox_composite)
data_composite <- raw_data %>%
mutate(adv_composite = adv_rain+adv_sib+adv_mom_dsi) %>%
select(adv_density, adv_mom, adv_composite)
cox_composite <- coxph(
Surv(data$age, data$dead) ~ adv_density + adv_mom + adv_mom:adv_composite,
data = data_composite
)
summary(cox_composite)
data_composite <- raw_data %>%
mutate(adv_composite = factor(adv_rain+adv_sib+adv_mom_dsi)) %>%
select(adv_density, adv_mom, adv_composite)
cox_composite <- coxph(
Surv(data$age, data$dead) ~ adv_density + adv_mom + adv_mom:adv_composite,
data = data_composite
)
summary(cox_composite)
data_composite <- raw_data %>%
mutate(adv_composite = adv_rain+adv_sib+adv_mom_dsi) %>%
select(adv_density, adv_mom, adv_composite)
cox_composite <- coxph(
Surv(data$age, data$dead) ~ adv_density + adv_mom + adv_mom:adv_composite,
data = data_composite
)
summary(cox_composite)
final <- penalized(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
lambda1 = 5,#opt$lambda,
trace = F
)
nonzero_varnames <- names(final@penalized)[final@penalized != 0]
nonzero_varnames
formula = paste("Surv(data$age, data$dead) ~", paste0(nonzero_varnames, collapse = "+ "))
cox <- coxph(
as.formula(formula),
data = data.frame(penalized_covariates)
)
summary(cox)
data_composite <- raw_data %>%
mutate(adv_composite = adv_rain+adv_sib+adv_mom_dsi) %>%
select(adv_density, adv_mom, adv_composite)
cox_composite <- coxph(
Surv(data$age, data$dead) ~ adv_density + adv_mom + adv_mom:adv_composite,
data = data_composite
)
summary(cox_composite)
final <- penalized(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
lambda1 = opt$lambda,
trace = F
)
nonzero_varnames <- names(final@penalized)[final@penalized != 0]
nonzero_varnames
formula = paste("Surv(data$age, data$dead) ~", paste0(nonzero_varnames, collapse = "+ "))
cox <- coxph(
as.formula(formula),
data = data.frame(penalized_covariates)
)
summary(cox)
data_composite <- raw_data %>%
mutate(adv_composite = adv_rain+adv_sib+adv_mom_dsi) %>%
select(adv_density, adv_mom, adv_composite)
cox_composite <- coxph(
Surv(data$age, data$dead) ~ adv_density + adv_mom + adv_mom:adv_composite,
data = data_composite
)
summary(cox_composite)
library(readxl)
#raw_data <- read_excel("Aim3-early-adversity-subjects-F-survival-2020-10-09.xlsx")
raw_data <- read_excel(
"Aim3-early-adversity-subjects-F-survival-2020-10-09.xlsx",
col_types = c("text", "numeric", "text",
"numeric", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "numeric"))
View(raw_data)
data <- raw_data %>%
mutate(sex = factor(sex),
matgrp = factor(matgrp),
status = factor(status))
summary(data)
data_sub <- data %>% select(starts_with("adv_"))
# interactions selected are between adv_mom:other, and adv_rain:other
formula <- "~ . + adv_mom:(.-adv_cumulative) + adv_rain:(.-adv_cumulative)"
penalized_covariates <- model.matrix(as.formula(formula) , data = data.frame(data_sub))
# remove intercept ready for penalized covariates
penalized_covariates <- penalized_covariates[, colnames(penalized_covariates) != "(Intercept)"]
set.seed(42)
cv <- profL1(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
fold = 5,
minlambda1 = 5,
maxlambda1 = 25,
trace = F
)
cv <- profL1(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
fold = 5,
minlambda1 = 5,
maxlambda1 = 25,
trace = F
)
set.seed(42)
opt <- optL1(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
fold = 5,
trace = F
)
ggplot() +
geom_line(aes(x = cv$lambda, y = cv$cvl)) +
geom_vline(xintercept = opt$lambda,
color = "gray", size = 2) +
labs(x = TeX("$\\lambda$"), y = "Partial Likelihood",
caption = "Cross-validated partial likelihood for a range values of lambda. The vertical gray line shows the global maximum.") +
theme_bw()
set.seed(42)
cv <- profL1(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
fold = 5,
minlambda1 = 5,
maxlambda1 = 25,
trace = F
)
opt <- optL1(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
fold = 5,
trace = F
)
ggplot() +
geom_line(aes(x = cv$lambda, y = cv$cvl)) +
geom_vline(xintercept = opt$lambda,
color = "gray", size = 2) +
labs(x = TeX("$\\lambda$"), y = "Partial Likelihood",
caption = "Cross-validated partial likelihood for a range values of lambda. The vertical gray line shows the global maximum.") +
theme_bw()
cv <- profL1(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
fold = 5,
minlambda1 = 5,
maxlambda1 = 25,
trace = F
)
opt <- optL1(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
fold = 5,
trace = F
)
ggplot() +
geom_line(aes(x = cv$lambda, y = cv$cvl)) +
geom_vline(xintercept = opt$lambda,
color = "gray", size = 2) +
labs(x = TeX("$\\lambda$"), y = "Partial Likelihood",
caption = "Cross-validated partial likelihood for a range values of lambda. The vertical gray line shows the global maximum.") +
theme_bw()
stepwise <- penalized(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
steps = 20,
lambda1 = 1,
trace = F
)
plotpath(
stepwise,
labelsize = 0.8,
standardize = T
)
abline(
v = opt$lambda,
col = "gray",
lwd = 2
)
stepwise <- penalized(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
steps = 20,
lambda1 = 1,
trace = F
)
plotpath(
stepwise,
labelsize = 0.8,
standardize = T
)
abline(
v = opt$lambda,
col = "gray",
lwd = 2
)
final <- penalized(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
lambda1 = opt$lambda,
trace = F
)
nonzero_varnames <- names(final@penalized)[final@penalized != 0]
nonzero_varnames
formula = paste("Surv(data$age, data$dead) ~", paste0(nonzero_varnames, collapse = "+ "))
cox <- coxph(
as.formula(formula),
data = data.frame(penalized_covariates)
)
summary(cox)
data_composite <- raw_data %>%
mutate(adv_composite = adv_rain+adv_sib+adv_mom_dsi) %>%
select(adv_density, adv_mom, adv_composite)
cox_composite <- coxph(
Surv(data$age, data$dead) ~ adv_density + adv_mom + adv_mom:adv_composite,
data = data_composite
)
summary(cox_composite)
library(survival)
library(tidyverse)
library(penalized)
library(latex2exp)
library(readxl)
raw_data <- read_excel("Aim3-early-adversity-subjects-F-survival-2020-10-09.xlsx")
# sum(is.na(raw_data))
data <- raw_data %>%
mutate(sex = factor(sex),
matgrp = factor(matgrp),
status = factor(status))
summary(data)
data_sub <- data %>% select(starts_with("adv_"))
# interactions selected are between adv_mom:other, and adv_rain:other
formula <- "~ . + adv_mom:(.-adv_cumulative) + adv_rain:(.-adv_cumulative)"
penalized_covariates <- model.matrix(as.formula(formula) , data = data.frame(data_sub))
# remove intercept ready for penalized covariates
penalized_covariates <- penalized_covariates[, colnames(penalized_covariates) != "(Intercept)"]
data_composite <- raw_data %>%
mutate(adv_composite = adv_rain+adv_sib+adv_mom_dsi) %>%
select(adv_density, adv_mom, adv_composite)
summary(data_composite)
cox_composite <- coxph(
Surv(data$age, data$dead) ~ adv_density + adv_mom + adv_mom*adv_composite,
data = data_composite
)
summary(cox_composite)
cox_composite <- coxph(
Surv(data$age, data$dead) ~ adv_density + adv_mom + adv_mom:adv_composite,
data = data_composite
)
summary(cox_composite)
summary(cox_composite)
cox_composite <- coxph(
Surv(data$age, data$dead) ~ adv_density + adv_mom + adv_mom*adv_composite,
data = data_composite
)
summary(cox_composite)
formula = paste("Surv(data$age, data$dead) ~", paste0(nonzero_varnames, collapse = "+ "))
cox <- coxph(
as.formula(formula),
data = data.frame(penalized_covariates)
)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(survival)
library(tidyverse)
library(penalized)
library(latex2exp)
library(readxl)
raw_data <- read_excel("Aim3-early-adversity-subjects-F-survival-2020-10-09.xlsx")
# sum(is.na(raw_data))
data <- raw_data %>%
mutate(sex = factor(sex),
matgrp = factor(matgrp),
status = factor(status))
summary(data)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(survival)
library(tidyverse)
library(penalized)
library(latex2exp)
library(readxl)
raw_data <- read_excel("Aim3-early-adversity-subjects-F-survival-2020-10-09.xlsx")
# sum(is.na(raw_data))
data <- raw_data %>%
mutate(sex = factor(sex),
matgrp = factor(matgrp),
status = factor(status))
summary(data)
data_sub <- data %>% select(starts_with("adv_"))
# interactions selected are between adv_mom:other, and adv_rain:other
formula <- "~ . + adv_mom:(.-adv_cumulative) + adv_rain:(.-adv_cumulative)"
penalized_covariates <- model.matrix(as.formula(formula) , data = data.frame(data_sub))
# remove intercept ready for penalized covariates
penalized_covariates <- penalized_covariates[, colnames(penalized_covariates) != "(Intercept)"]
set.seed(42)
cv <- profL1(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
fold = 5,
minlambda1 = 5,
maxlambda1 = 25,
trace = F
)
set.seed(42)
opt <- optL1(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
fold = 5,
trace = F
)
ggplot() +
geom_line(aes(x = cv$lambda, y = cv$cvl)) +
geom_vline(xintercept = opt$lambda,
color = "gray", size = 2) +
labs(x = TeX("$\\lambda$"), y = "Partial Likelihood",
caption = "Cross-validated partial likelihood for a range values of lambda. The vertical gray line shows the global maximum.") +
theme_bw()
stepwise <- penalized(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
steps = 20,
lambda1 = 1,
trace = F
)
plotpath(
stepwise,
labelsize = 0.8,
standardize = T
)
abline(
v = opt$lambda,
col = "gray",
lwd = 2
)
final <- penalized(
Surv(data$age, data$dead),
penalized = penalized_covariates,
standardize = T,
lambda1 = opt$lambda,
trace = F
)
nonzero_varnames <- names(final@penalized)[final@penalized != 0]
nonzero_varnames
formula = paste("Surv(data$age, data$dead) ~", paste0(nonzero_varnames, collapse = "+ "))
cox <- coxph(
as.formula(formula),
data = data.frame(penalized_covariates)
)
summary(cox)
data_composite <- raw_data %>%
mutate(adv_composite = adv_rain+adv_sib+adv_mom_dsi) %>%
select(adv_density, adv_mom, adv_composite)
cox_composite <- coxph(
Surv(data$age, data$dead) ~ adv_density + adv_mom + adv_mom*adv_composite,
data = data_composite
)
summary(cox_composite)
